<!DOCTYPE html>
<html>
<head>
  <title>Komentar Spam</title>
  <style>
    body { font-family: Arial, sans-serif; }
    ul { list-style: none; padding-left: 0; }
    li { margin-bottom: 8px; }
    #deleteBtn:disabled { background: #ccc; color: #888; }
    .warning { color: red; font-weight: bold; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>üö® Ditemukan <%= comments.length %> komentar spam</h1>
  
  <% if (!user.isOwner) { %>
    <div class="warning">‚ö†Ô∏è Kamu bukan pemilik video ini. Kamu hanya bisa melaporkan komentar sebagai spam, bukan menghapusnya permanent.</div>
  <% } %>
  
  <form method="POST" action="/delete-comments" id="deleteForm">
    <input type="hidden" name="isOwner" value="<%= user.isOwner ? '1' : '0' %>">
    <label>
      <input type="checkbox" id="selectAll"> Pilih Semua
    </label>
    
    <% if (user.isOwner) { %>
      <div style="margin-top:8px;">
        <label>
          <input type="checkbox" name="permanentDelete" value="1"> Hapus Permanen (Tidak bisa di-undo)
        </label>
      </div>
    <% } %>

    <ul>
      <% comments.forEach(function(c) { %>
        <li>
          <label>
            <input type="checkbox" class="comment-checkbox" name="ids" value="<%= c.id %>">
            <b><%= c.author %>:</b> <%= c.text %>
          </label>
        </li>
      <% }); %>
    </ul>
    
    <% if (user.isOwner) { %>
      <button type="submit" id="deleteBtn" disabled>Hapus Komentar Terpilih</button>
    <% } else { %>
      <button type="submit" id="deleteBtn" disabled>Report sebagai Spam</button>
    <% } %>
  </form>

  <script>
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('.comment-checkbox');
    const deleteBtn = document.getElementById('deleteBtn');
    function updateDeleteBtn() {
      deleteBtn.disabled = document.querySelectorAll('.comment-checkbox:checked').length === 0;
    }
    selectAll.addEventListener('change', function() {
      checkboxes.forEach(cb => cb.checked = selectAll.checked);
      updateDeleteBtn();
    });
    checkboxes.forEach(cb => {
      cb.addEventListener('change', function() {
        updateDeleteBtn();
        if (!this.checked) selectAll.checked = false;
        else if (document.querySelectorAll('.comment-checkbox:checked').length === checkboxes.length) selectAll.checked = true;
      });
    });
    updateDeleteBtn();
  </script>
</body>
</html>
