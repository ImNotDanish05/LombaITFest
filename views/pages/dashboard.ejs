<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    .power-btn {
      position: absolute;
      top: 20px;
      right: 30px;
      color: #dc3545;
      font-size: 2rem;
      z-index: 10;
      text-decoration: none;
    }
    .power-btn:hover { color: #b52a1d; }
  </style>
</head>
<body class="bg-light">
  <% if (user) { %>
    <a href="/delete-account" class="power-btn" title="Hapus Akun">
      <i class="bi bi-power"></i>
    </a>
  <% } %>
  <div class="container py-5">
    <div class="card mx-auto" style="max-width:500px;">
      <div class="card-body text-center">
        <% if (!(typeof comments !== 'undefined' && comments.length > 0)) { %>
          <h2 class="mb-3 text-success"><i class="bi bi-check-circle-fill"></i> Selamat datang, <%= user.name %>!</h2>
          <img src="<%= user.picture %>" class="rounded-circle mb-3" width="100" alt="Foto Profil">
          <p><strong>Email:</strong> <%= user.email %></p>
          <button id="showFormBtn" class="btn btn-primary mt-4">
            <i class="bi bi-youtube"></i> Ambil Komentar dari YouTube
          </button>
          <form id="youtubeForm" class="mt-4" action="/get-comments" method="POST" style="display:none;">
            <div class="mb-3">
              <input type="url" name="youtubeUrl" class="form-control" placeholder="Masukkan link YouTube" required>
            </div>
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" name="useAiJudol" value="1" id="useAiJudol">
              <label class="form-check-label" for="useAiJudol">
                Pakai AI Judol Detector
              </label>
            </div>
            <button type="submit" class="btn btn-success">Dapatkan Komentar</button>
          </form>
        <% } %>
      </div>
    </div>
  </div>
  <script>
    var showFormBtn = document.getElementById('showFormBtn');
    if (showFormBtn) {
      showFormBtn.onclick = function() {
        document.getElementById('youtubeForm').style.display = 'block';
        this.style.display = 'none';
      };
    }
  </script>
  <% if (typeof comments !== 'undefined' && comments.length > 0) { %>
    <div class="mt-4">
      <h4>Daftar Komentar</h4>
      <form action="/delete-comments" method="POST">
        <div class="mb-2 text-start">
          <input type="checkbox" id="selectAll" class="form-check-input">
          <label for="selectAll" class="form-check-label ms-1">Pilih Semua</label>
        </div>
        <ul class="list-group">
          <% comments.forEach((c, idx) => { %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div class="form-check">
                <input class="form-check-input comment-checkbox" type="checkbox" name="commentId" value="<%= c.commentId %>" id="comment<%= idx %>">
                <label class="form-check-label ms-2" for="comment<%= idx %>"><%= c.text %></label>
              </div>
              <% if (c.isSpam) { %>
                <span class="badge bg-danger">Spam</span>
              <% } %>
            </li>
          <% }); %>
        </ul>
        <button type="submit" class="btn btn-danger mt-3">Hapus Komentar Terpilih</button>
      </form>
    </div>
    <script>
      document.getElementById('selectAll').onclick = function() {
        const checkboxes = document.querySelectorAll('.comment-checkbox');
        checkboxes.forEach(cb => cb.checked = this.checked);
      };
    </script>
  <% } %>
</body>
</html>